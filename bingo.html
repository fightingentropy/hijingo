<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Bingo Game</title>
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
    <style>
      body {
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #333333; /* Updated to dark grey */
      }
      .game-container {
        background-color: #2c2c2c; /* Reverted back to the original darker shade */
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        padding: 20px;
        max-width: 400px;
        width: 100%;
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .game-number {
        font-size: 1.2em;
        font-weight: bold;
        color: #ffffff; /* Changed to white */
      }
      .qr-code {
        width: 50px;
        height: 50px;
        background-color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 5px;
        overflow: hidden;
        border: 2px solid #000000; /* Added black border */
      }

      .qr-code img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .bingo-card {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Changed from 5 to 4 columns */
        gap: 10px;
        margin-bottom: 20px;
      }
      .bingo-cell {
        aspect-ratio: 1;
        border: 2px solid #8b0000; /* Changed to dark red */
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2em;
        font-weight: bold;
        color: #ffffff; /* Changed back to white */
        background-color: #4a4a4a; /* Updated to a lighter shade */
      }
      .bingo-cell:hover:not(.marked) {
        background-color: #4a4a4a;
      }
      .marked {
        background-color: #ff0000 !important; /* Changed to standard red */
        color: #ffffff; /* Keep this white for better contrast on red background */
      }
      #new-game {
        width: 100%;
        padding: 10px;
        background-color: #8b0000; /* Changed to dark red */
        color: #ffffff; /* Changed to white */
        border: none;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      #new-game:hover {
        background-color: #660000; /* Even darker red on hover */
      }

      h1 {
        color: #ffffff; /* Changed to white */
        text-align: center;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 2em; /* Adjust size as needed */
      }

      .win-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(255, 255, 255, 0.9);
        color: #8b0000;
        padding: 20px;
        border-radius: 10px;
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>HIJINGO</h1>
      <div class="card-header">
        <div class="game-number" id="game-number"></div>
        <div class="qr-code">
          <img
            src="https://api.qrserver.com/v1/create-qr-code/?size=50x50&data=https://example.com/bingo"
            alt="QR Code"
          />
        </div>
      </div>
      <div id="bingo-card" class="bingo-card"></div>
      <button id="new-game">New Game</button>
    </div>

    <script>
      const bingoCard = document.getElementById('bingo-card');
      const newGameBtn = document.getElementById('new-game');
      const gameNumber = document.getElementById('game-number');
      let winLevels = { level1: false, level2: false, level3: false };

      function showWinMessage(level) {
        const message = document.createElement('div');
        message.className = 'win-message';
        message.textContent = `Level ${level} Win!`;
        document.body.appendChild(message);

        setTimeout(() => {
          message.style.opacity = '1';
        }, 100);

        setTimeout(() => {
          message.style.opacity = '0';
          setTimeout(() => {
            document.body.removeChild(message);
          }, 500);
        }, 2000);
      }

      function showWinAnimation(level) {
        let particleCount, spread, duration;
        switch (level) {
          case 1:
            particleCount = 200;
            spread = 100;
            duration = 3000;
            break;
          case 2:
            particleCount = 400;
            spread = 120;
            duration = 4000;
            break;
          case 3:
            particleCount = 600;
            spread = 140;
            duration = 5000;
            break;
        }

        const colors = ['#ff0000', '#ffffff', '#8b0000', '#ffd700', '#ff69b4'];

        const origins = [
          { x: 0, y: 0 }, // top-left
          { x: 1, y: 0 }, // top-right
          { x: 0, y: 1 }, // bottom-left
          { x: 1, y: 1 }, // bottom-right
          { x: 0.5, y: 0.5 }, // center
          { x: 0.25, y: 0.25 }, // top-left quadrant
          { x: 0.75, y: 0.25 }, // top-right quadrant
          { x: 0.25, y: 0.75 }, // bottom-left quadrant
          { x: 0.75, y: 0.75 }, // bottom-right quadrant
        ];

        origins.forEach((origin) => {
          confetti({
            particleCount: particleCount / origins.length,
            spread: spread,
            origin: origin,
            colors: colors,
            ticks: 300,
            gravity: 0.8,
            scalar: 1.2,
            drift: 0,
            shapes: ['square', 'circle'],
          });
        });

        // Add a delayed burst for extra effect
        setTimeout(() => {
          confetti({
            particleCount: particleCount / 2,
            spread: spread * 1.5,
            origin: { x: 0.5, y: 0.5 },
            colors: colors,
            ticks: 200,
            gravity: 0.9,
            scalar: 1.5,
            drift: 1,
            shapes: ['star'],
          });
        }, duration / 2);

        // Add win message
        showWinMessage(level);
      }

      function checkWin() {
        const cells = document.querySelectorAll('.bingo-cell');
        const markedCells = document.querySelectorAll('.bingo-cell.marked');

        // Check diagonals
        const topLeftToBottomRight = [0, 5, 10, 15].every((i) =>
          cells[i].classList.contains('marked')
        );
        const topRightToBottomLeft = [3, 6, 9, 12].every((i) =>
          cells[i].classList.contains('marked')
        );

        if (
          (topLeftToBottomRight || topRightToBottomLeft) &&
          !winLevels.level1
        ) {
          showWinAnimation(1);
          winLevels.level1 = true;
        }

        if (topLeftToBottomRight && topRightToBottomLeft && !winLevels.level2) {
          showWinAnimation(2);
          winLevels.level2 = true;
        }

        if (markedCells.length === 16 && !winLevels.level3) {
          showWinAnimation(3);
          winLevels.level3 = true;
        }
      }

      function generateBingoCard() {
        winLevels = { level1: false, level2: false, level3: false }; // Reset win levels for new game
        bingoCard.innerHTML = '';
        const numbers = new Set();
        while (numbers.size < 16) {
          numbers.add(Math.floor(Math.random() * 75) + 1);
        }
        const numbersArray = Array.from(numbers);
        for (let i = 0; i < 16; i++) {
          const cell = document.createElement('div');
          cell.className = 'bingo-cell';
          cell.textContent = numbersArray[i];
          cell.addEventListener('click', () => {
            cell.classList.toggle('marked');
            checkWin(); // Check for win after each cell is marked
          });
          bingoCard.appendChild(cell);
        }
        gameNumber.textContent = `Game #${Math.floor(Math.random() * 2) + 1}`;
      }

      newGameBtn.addEventListener('click', generateBingoCard);

      // Initialize the game
      generateBingoCard();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  </body>
</html>
